<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SE thingy</title>
  <link rel="stylesheet" href="css/style.css">

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icon.png">

  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#fafafa">
</head>

<body>
  <div class="topbar">
    <input type="button" class="topbar-button" value="+" onclick="newRecipe()">
  </div>

  <div hidden id="recipe-template" class="recipe">
    <div id="recipe-header-template" class="recipe-header">
      <div>Recipe</div>
      <input type="button" class="recipe-delete-button" value="-" onclick="deleteRecipe(this.parentNode.parentNode)">
    </div>
    <table class="recipe-data">
      <tr>
        <td>aaaaaaaaaaaaaaaaaaaa</td>
        <td>b</td>
      </tr>
      <tr>
        <td>a</td>
        <td>bbbbbbbbbbbbbbb</td>
      </tr>
    </table>
  </div>

  <div id="recipes"></div>

  <svg width="1000" height="1000" xmlns="http://www.w3.org/2000/svg">
    <path d="M 0 0 t 100 200 100 0" stroke="blue" stroke-width="4" fill="none"/>
  </svg>

  <script>
    let recipeCounter = 0;

    function newRecipe() {
      let recipe = document.getElementById("recipe-template").cloneNode(true);
      recipe.removeAttribute("hidden")
      recipe.id = `recipe${recipeCounter}`
      recipe.querySelector("#recipe-header-template").id = `recipe${recipeCounter}-header`
      document.getElementById("recipes").appendChild(recipe)
      dragElement(recipe);

      recipeCounter++;
    }

    function deleteRecipe(recipe) {
      document.getElementById(recipe.id).remove()
    }

    // https://www.w3schools.com/howto/howto_js_draggable.asp
    function dragElement(elmnt) {
      let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      if (document.getElementById(elmnt.id + "-header")) {
        // if present, the header is where you move the DIV from:
        document.getElementById(elmnt.id + "-header").onmousedown = dragMouseDown;
      } else {
        // otherwise, move the DIV from anywhere inside the DIV:
        elmnt.onmousedown = dragMouseDown;
      }

      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        // get the mouse cursor position at startup:
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        // call a function whenever the cursor moves:
        document.onmousemove = elementDrag;
      }

      function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        // calculate the new cursor position:
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        // set the element's new position:
        elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
        elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
      }

      function closeDragElement() {
        // stop moving when mouse button is released:
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }
  </script>
</body>

</html>
