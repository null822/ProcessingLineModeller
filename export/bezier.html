<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bezier Testing :)</title>
</head>
<body>


<div id="bezier1">
  <svg width="1000" height="1000" xmlns="http://www.w3.org/2000/svg">
    <path d="M 0 0 c 100 100, 200 0, 300, 100" stroke="black" stroke-width="4" fill="none"/>
  </svg>
  <div id="handle1" style="position: absolute; left: 0; top: 0; cursor: move">
    <svg width="12" height="12"><circle r="5" cx="5" cy="5" fill="green"/></svg>
  </div>
  <div id="handle2" style="position: absolute; left: 50px; top: 0; cursor: move">
    <svg width="12" height="12"><circle r="5" cx="5" cy="5" fill="green"/></svg>
  </div>
</div>
<script>

  let curve = [
    0, 0,
    0, 0
  ]

  dragElement(document.getElementById("handle1"))
  dragElement(document.getElementById("handle2"))

  // https://www.w3schools.com/howto/howto_js_draggable.asp
  function dragElement(elmnt) {
    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    if (document.getElementById(elmnt.id + "-header")) {
      // if present, the header is where you move the DIV from:
      document.getElementById(elmnt.id + "-header").onmousedown = dragMouseDown;
    } else {
      // otherwise, move the DIV from anywhere inside the DIV:
      elmnt.onmousedown = dragMouseDown;
    }
    onDrag(elmnt)

    function dragMouseDown(e) {
      e = e || window.event;
      e.preventDefault();
      // get the mouse cursor position at startup:
      pos3 = e.clientX;
      pos4 = e.clientY;
      document.onmouseup = closeDragElement;
      // call a function whenever the cursor moves:
      document.onmousemove = elementDrag;
    }

    function elementDrag(e) {
      e = e || window.event;
      e.preventDefault();
      // calculate the new cursor position:
      pos1 = pos3 - e.clientX;
      pos2 = pos4 - e.clientY;
      pos3 = e.clientX;
      pos4 = e.clientY;
      // set the element's new position:
      elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
      elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";

      onDrag(elmnt)
    }

    function closeDragElement() {
      // stop moving when mouse button is released:
      document.onmouseup = null;
      document.onmousemove = null;
    }
  }

  function onDrag(elmnt) {
    const id = elmnt.id;

    if (!id.startsWith("handle"))
      return;

    let index = id.substring(6, id.length) - 1

    curve[index * 2] = parseInt(elmnt.style.left.substring(0, elmnt.style.left.length - 2));
    curve[index * 2 + 1] = parseInt(elmnt.style.top.substring(0, elmnt.style.top.length - 2));

    updateCurve(elmnt.parentNode.getElementsByTagName("path")[0],
      true, curve[0], curve[1],
      true, curve[2], curve[3])
  }

  /**
   * Updates the supplied Bézier curve.
   * @param curve a \<div> containing the curve SVG
   * @param ah whether point A is connected to horizontally
   * @param ax the X coordinate of point A
   * @param ay the Y coordinate of point A
   * @param bh whether point B is connected to horizontally
   * @param bx the X coordinate of point B
   * @param by the Y coordinate of point B
   */
  function updateCurve(curve, ah, ax, ay, bh, bx, by) {

    let directionX = bx - ax;
    let directionY = by - ay;

    let cx = ax // point C (handle for point A)
    let cy = ay
    let dx = bx // point D (handle for point B)
    let dy = by

    if (ah) cx = Math.round(ax + directionX / 3)
    else    cy = Math.round(ay + directionY / 3)
    if (bh) dx = Math.round(bx - directionX / 3)
    else    dy = Math.round(by - directionY / 3)

    let path = `M ${ax} ${ay} c ${cx - ax} ${cy - ay}, ${dx - ax} ${dy - ay}, ${bx - ax} ${by - ay}`;
    curve.setAttribute("d", path)
  }
</script>
</body>
</html>
